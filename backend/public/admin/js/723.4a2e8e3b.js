"use strict";(self["webpackChunksherlock_godjango_admin_ui"]=self["webpackChunksherlock_godjango_admin_ui"]||[]).push([[723],{723:(e,a,t)=>{t.r(a),t.d(a,{default:()=>X});var l=t(9835),n=t(499),o=t(6970),i=t(5304),u=t(8910),s=t(28),c=t(685),r=t(1957),m=t(33),d=function(e,a,t,l){function n(e){return e instanceof t?e:new t((function(a){a(e)}))}return new(t||(t=Promise))((function(t,o){function i(e){try{s(l.next(e))}catch(a){o(a)}}function u(e){try{s(l["throw"](e))}catch(a){o(a)}}function s(e){e.done?t(e.value):n(e.value).then(i,u)}s((l=l.apply(e,a||[])).next())}))};const p=(0,l.aZ)({props:{assignment:null},emits:["complete","cancel"],setup(e,{emit:a}){const t=e,o=(0,i.Ey)(i.VT),u=(0,n.iH)({id:0,created_at:"",name:"",position:m.he,status:0,contact:"",updated_at:""});function c(e){u.value.position=e}function p(){return d(this,void 0,void 0,(function*(){m.j7.loading();try{yield o.addCheckpoint(t.assignment.id,u.value),a("complete")}catch(e){m.j7.axiosError(e)}m.j7.loading(!1)}))}return(e,t)=>{const o=(0,l.up)("q-input"),i=(0,l.up)("q-card-section"),d=(0,l.up)("q-btn"),v=(0,l.up)("q-card-actions"),k=(0,l.up)("q-form"),w=(0,l.up)("q-card");return(0,l.wg)(),(0,l.j4)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(k,{onSubmit:(0,r.iM)(p,["prevent"])},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{class:"q-gutter-y-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:u.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value.name=e),type:"text",label:"Nombre"},null,8,["modelValue"]),(0,l.Wm)(o,{modelValue:u.value.contact,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value.contact=e),type:"text",label:"Contacto"},null,8,["modelValue"]),(0,l.Wm)(s.Z,{style:{height:"50vh"},onAddMarker:c,markers:[u.value.position],center:(0,n.SU)(m.he)},null,8,["markers","center"])])),_:1}),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"Cancelar",onClick:t[2]||(t[2]=e=>a("cancel")),color:"primary",outline:""}),(0,l.Wm)(d,{label:"Guardar",type:"submit",color:"primary"})])),_:1})])),_:1},8,["onSubmit"])])),_:1})}}});var v=t(4458),k=t(8326),w=t(3190),f=t(6611),g=t(1821),y=t(4455),_=t(9984),h=t.n(_);const W=p,U=W;h()(p,"components",{QCard:v.Z,QForm:k.Z,QCardSection:w.Z,QInput:f.Z,QCardActions:g.Z,QBtn:y.Z});var b=t(4587),C=t(4072),q=t(7506),S=t(4379),Z=function(e,a,t,l){function n(e){return e instanceof t?e:new t((function(a){a(e)}))}return new(t||(t=Promise))((function(t,o){function i(e){try{s(l.next(e))}catch(a){o(a)}}function u(e){try{s(l["throw"](e))}catch(a){o(a)}}function s(e){e.done?t(e.value):n(e.value).then(i,u)}s((l=l.apply(e,a||[])).next())}))};const j={class:"row q-col-gutter-sm"},x={class:"col-xs-12 col-sm-6 col-lg-4"},Q={class:"text-h6"},V={key:0,class:"text-body1"},E={class:"text-subtitle1"},I={key:0,class:"text-subtitle2"},z={class:"text-subtitle2"},D={key:1},H=(0,l._)("div",{class:"text-body1 text-center"},"Checkpoints",-1),P=(0,l.Uk)("Todos"),N=(0,l.Uk)("Mi Posición"),A=(0,l.Uk)("Nuevo Checkpoint"),F={key:0,class:"col-sm-6 col-lg-8"},T=(0,l.aZ)({setup(e){const a=(0,i.Ey)(i.ju),t=(0,i.Ey)(i.VT),r=(0,i.Ey)(i.cH),d=(0,m.GZ)(),p=(0,u.yj)(),v=(0,n.iH)(0),k=(0,l.Fl)((()=>{if(W.value)return t.getById(v.value);const e=r.assignments.findIndex((e=>e.id===v.value));return r.assignments[e]})),w=(0,l.Fl)((()=>a.currentPosition)),f=(0,n.iH)(),g=(0,l.Fl)((()=>{var e,a;const t=[];return f.value?[(0,b.latLng)(f.value.position.lat,f.value.position.lng)]:(null===(a=null===(e=k.value)||void 0===e?void 0:e.checkpoints)||void 0===a||a.forEach((e=>{t.push((0,b.latLng)(e.position.lat,e.position.lng))})),t)})),y=(0,n.iH)(!1),_=(0,n.iH)(!1),h=(0,n.iH)(!1),W=(0,l.Fl)((()=>p.name===C.I.ADMIN_ASSIGNMENT)),T=(0,l.Fl)((()=>q.ZP.is.mobile)),G=(0,n.iH)(15);function M(){y.value=!1,h.value=!1}function L(e){W.value||S.$router.push({name:C.I.AGENT_CHECKPOINT,params:{id:e}})}function B(){return Z(this,void 0,void 0,(function*(){w.value||(yield a.getGpsPosition(),r.agent&&w.value&&(r.agent.position=w.value)),_.value=!0}))}function O(e){d.deleteDialog({message:"Desea eliminar el checkpoint?",onOk:()=>Z(this,void 0,void 0,(function*(){m.j7.loading();try{yield t.removeCheckpoint(e.assignment_id,e.id)}catch(a){m.j7.axiosError(a,"No se pudo eliminar")}m.j7.loading(!1)})),title:"Eliminar Checkpoint"})}return(0,l.wF)((()=>{p.params&&p.params.id&&(v.value=Number(p.params.id))})),(e,a)=>{const t=(0,l.up)("q-btn"),i=(0,l.up)("q-chip"),u=(0,l.up)("q-card-section"),r=(0,l.up)("q-icon"),m=(0,l.up)("q-item-section"),d=(0,l.up)("q-item"),p=(0,l.up)("q-item-label"),v=(0,l.up)("q-avatar"),b=(0,l.up)("q-list"),C=(0,l.up)("q-card"),q=(0,l.up)("q-dialog"),S=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(S,{padding:""},{default:(0,l.w5)((()=>[(0,n.SU)(k)?((0,l.wg)(),(0,l.j4)(C,{key:0,class:"no-box-shadow"},{default:(0,l.w5)((()=>[(0,l._)("div",j,[(0,l._)("div",x,[(0,l.Wm)(u,{class:"q-gutter-y-sm"},{default:(0,l.w5)((()=>[(0,l._)("div",Q,(0,o.zw)((0,n.SU)(k).name),1),(0,n.SU)(W)?((0,l.wg)(),(0,l.iD)("div",V,[(0,l.Wm)(t,{color:"primary",icon:"mdi-pencil",label:"Administrar",class:"full-width",onClick:a[0]||(a[0]=e=>h.value=!0)})])):(0,l.kq)("",!0),(0,l._)("div",E,[(0,l.Wm)(i,{class:"glossy",icon:0===(0,n.SU)(k).status?"mdi-clock":"mdi-check",label:0===(0,n.SU)(k).status?"En Progreso":"Completado",color:0===(0,n.SU)(k).status?"":"positive"},null,8,["icon","label","color"])])])),_:1}),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>{var e;return[(0,n.SU)(k).agent?((0,l.wg)(),(0,l.iD)("p",I,[(0,l.Wm)(r,{name:"mdi-account",class:"q-mr-sm"}),(0,l.Uk)(" "+(0,o.zw)(null===(e=(0,n.SU)(k).agent)||void 0===e?void 0:e.nick),1)])):(0,l.kq)("",!0),(0,l._)("p",z," Descripción: "+(0,o.zw)((0,n.SU)(k).description),1),(0,n.SU)(k).observations?((0,l.wg)(),(0,l.iD)("p",D," Observaciones: "+(0,o.zw)((0,n.SU)(k).observations),1)):(0,l.kq)("",!0)]})),_:1}),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[H,(0,l.Wm)(b,{bordered:"",class:"q-mt-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{clickable:"",onClick:a[1]||(a[1]=e=>f.value=void 0)},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"mdi-map-marker"})])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[P])),_:1})])),_:1}),(0,n.SU)(W)?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(d,{key:0,clickable:"",onClick:B},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"mdi-map-marker"})])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[N])),_:1})])),_:1})),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(k).checkpoints,((e,a)=>((0,l.wg)(),(0,l.j4)(d,{key:`checkpoint-${e.id}-index-${a}`},{default:(0,l.w5)((()=>[(0,n.SU)(T)?((0,l.wg)(),(0,l.j4)(m,{key:0,class:"cursor-pointer",avatar:"",onClick:a=>L(e.id)},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"mdi-eye"})])),_:2},1032,["onClick"])):((0,l.wg)(),(0,l.j4)(m,{key:1,class:"cursor-pointer",avatar:"",onClick:a=>f.value=e},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"mdi-map-marker"})])),_:2},1032,["onClick"])),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(p,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.name),1)])),_:2},1024),(0,l.Wm)(p,{caption:"",lines:"2"},{default:(0,l.w5)((()=>[0===e.status?((0,l.wg)(),(0,l.j4)(i,{key:0,class:"glossy",size:"sm",icon:"mdi-clock",label:"Pendiente"})):((0,l.wg)(),(0,l.j4)(i,{key:1,class:"glossy",size:"sm",icon:"mdi-check",label:"Completado"}))])),_:2},1024)])),_:2},1024),(0,n.SU)(W)?((0,l.wg)(),(0,l.j4)(m,{key:2,avatar:"",class:"cursor-pointer",onClick:a=>O(e)},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"mdi-delete",color:"negative"})])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:2},1024)))),128)),(0,n.SU)(W)?((0,l.wg)(),(0,l.j4)(d,{key:1,clickable:"",onClick:a[2]||(a[2]=e=>y.value=!0)},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{top:"",avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{color:"positive","text-color":"white",icon:"mdi-plus",size:"sm"})])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(p,null,{default:(0,l.w5)((()=>[A])),_:1})])),_:1})])),_:1})):(0,l.kq)("",!0)])),_:1})])),_:1})]),(0,n.SU)(T)?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",F,[(0,l.Wm)(s.Z,{readonly:"",markers:(0,n.SU)(g),center:(0,n.SU)(g)[0],zoom:G.value,onUpdateZoom:a[3]||(a[3]=e=>G.value=e)},null,8,["markers","center","zoom"])]))])])),_:1})):(0,l.kq)("",!0),(0,l.Wm)(q,{modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=e=>h.value=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(c.Z,{style:{"min-width":"20rem"},assignment:(0,n.SU)(k),onCancel:M,onComplete:M},null,8,["assignment"])])),_:1},8,["modelValue"]),(0,l.Wm)(q,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>y.value=e)},{default:(0,l.w5)((()=>[(0,n.SU)(k)?((0,l.wg)(),(0,l.j4)(U,{key:0,style:{"min-width":"20rem"},assignment:(0,n.SU)(k),onCancel:M,onComplete:M},null,8,["assignment"])):(0,l.kq)("",!0)])),_:1},8,["modelValue"]),(0,n.SU)(w)?((0,l.wg)(),(0,l.j4)(q,{key:1,modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=e=>_.value=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{style:{"min-width":"20rem"}},{default:(0,l.w5)((()=>[(0,l.Wm)(s.Z,{markers:[(0,n.SU)(w)],readonly:""},null,8,["markers"])])),_:1})])),_:1},8,["modelValue"])):(0,l.kq)("",!0)])),_:1})}}});var G=t(9885),M=t(7691),L=t(2857),B=t(3246),O=t(490),$=t(1233),K=t(3115),Y=t(1357),J=t(2074);const R=T,X=R;h()(T,"components",{QPage:G.Z,QCard:v.Z,QCardSection:w.Z,QBtn:y.Z,QChip:M.Z,QIcon:L.Z,QList:B.Z,QItem:O.Z,QItemSection:$.Z,QItemLabel:K.Z,QAvatar:Y.Z,QDialog:J.Z})}}]);