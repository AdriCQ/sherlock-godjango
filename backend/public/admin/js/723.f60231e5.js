"use strict";(globalThis["webpackChunksherlock_godjango_admin_ui"]=globalThis["webpackChunksherlock_godjango_admin_ui"]||[]).push([[723],{723:(e,a,l)=>{l.r(a),l.d(a,{default:()=>X});var t=l(9835),n=l(499),o=l(6970),i=l(5304),u=l(8910),s=l(28),c=l(685),r=l(1957),m=l(33),d=function(e,a,l,t){function n(e){return e instanceof l?e:new l((function(a){a(e)}))}return new(l||(l=Promise))((function(l,o){function i(e){try{s(t.next(e))}catch(a){o(a)}}function u(e){try{s(t["throw"](e))}catch(a){o(a)}}function s(e){e.done?l(e.value):n(e.value).then(i,u)}s((t=t.apply(e,a||[])).next())}))};const p=(0,t.aZ)({props:{assignment:null},emits:["complete","cancel"],setup(e,{emit:a}){const l=e,o=(0,i.Ey)(i.VT),u=(0,n.iH)({id:0,created_at:"",name:"",position:m.he,status:0,contact:"",updated_at:""});function c(e){u.value.position=e}function p(){return d(this,void 0,void 0,(function*(){m.j7.loading();try{yield o.addCheckpoint(l.assignment.id,u.value),a("complete")}catch(e){m.j7.axiosError(e)}m.j7.loading(!1)}))}return(e,l)=>{const o=(0,t.up)("q-input"),i=(0,t.up)("q-card-section"),d=(0,t.up)("q-btn"),v=(0,t.up)("q-card-actions"),k=(0,t.up)("q-form"),w=(0,t.up)("q-card");return(0,t.wg)(),(0,t.j4)(w,null,{default:(0,t.w5)((()=>[(0,t.Wm)(k,{onSubmit:(0,r.iM)(p,["prevent"])},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{class:"q-gutter-y-sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:u.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value.name=e),type:"text",label:"Nombre"},null,8,["modelValue"]),(0,t.Wm)(o,{modelValue:u.value.contact,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value.contact=e),type:"text",label:"Contacto"},null,8,["modelValue"]),(0,t.Wm)(s.Z,{style:{height:"50vh"},onAddMarker:c,markers:[u.value.position],center:(0,n.SU)(m.he)},null,8,["markers","center"])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{label:"Cancelar",onClick:l[2]||(l[2]=e=>a("cancel")),color:"primary",outline:""}),(0,t.Wm)(d,{label:"Guardar",type:"submit",color:"primary"})])),_:1})])),_:1},8,["onSubmit"])])),_:1})}}});var v=l(4458),k=l(8326),w=l(3190),g=l(6611),f=l(1821),y=l(4455),h=l(9984),_=l.n(h);const W=p,b=W;_()(p,"components",{QCard:v.Z,QForm:k.Z,QCardSection:w.Z,QInput:g.Z,QCardActions:f.Z,QBtn:y.Z});var U=l(4587),C=l(4072),q=l(7506),S=l(4379),Z=function(e,a,l,t){function n(e){return e instanceof l?e:new l((function(a){a(e)}))}return new(l||(l=Promise))((function(l,o){function i(e){try{s(t.next(e))}catch(a){o(a)}}function u(e){try{s(t["throw"](e))}catch(a){o(a)}}function s(e){e.done?l(e.value):n(e.value).then(i,u)}s((t=t.apply(e,a||[])).next())}))};const j={class:"row q-col-gutter-sm"},x={class:"col-xs-12 col-sm-6 col-lg-4"},Q={class:"text-h6"},V={key:0,class:"text-body1"},E={class:"text-subtitle1"},I={key:0,class:"text-subtitle2"},H={class:"text-subtitle2"},z={key:1},D=(0,t._)("div",{class:"text-body1 text-center"},"Checkpoints",-1),P=(0,t.Uk)("Todos"),N=(0,t.Uk)("Mi Posición"),A=(0,t.Uk)("Nuevo Checkpoint"),T={key:0,class:"col-sm-6 col-lg-8"},F=(0,t.aZ)({setup(e){const a=(0,i.Ey)(i.HA),l=(0,i.Ey)(i.VT),r=(0,i.Ey)(i.cH),d=(0,m.GZ)(),p=(0,u.yj)(),v=(0,n.iH)(0),k=(0,t.Fl)((()=>{if(W.value)return l.getById(v.value);const e=r.assignments.findIndex((e=>e.id===v.value));return r.assignments[e]})),w=(0,t.Fl)((()=>a.gpsPosition)),g=(0,n.iH)(),f=(0,t.Fl)((()=>{var e,a;const l=[];return g.value?[(0,U.latLng)(g.value.position.lat,g.value.position.lng)]:(null===(a=null===(e=k.value)||void 0===e?void 0:e.checkpoints)||void 0===a||a.forEach((e=>{l.push((0,U.latLng)(e.position.lat,e.position.lng))})),l)})),y=(0,n.iH)(!1),h=(0,n.iH)(!1),_=(0,n.iH)(!1),W=(0,t.Fl)((()=>p.name===C.I.ADMIN_ASSIGNMENT)),F=(0,t.Fl)((()=>q.ZP.is.mobile)),G=(0,n.iH)(15);function M(){y.value=!1,_.value=!1}function L(e){W.value||S.$router.push({name:C.I.AGENT_CHECKPOINT,params:{id:e}})}function B(){return Z(this,void 0,void 0,(function*(){w.value||(yield a.getGpsPosition(),r.agent&&w.value&&(r.agent.position=w.value)),h.value=!0}))}function O(e){d.deleteDialog({message:"Desea eliminar el checkpoint?",onOk:()=>Z(this,void 0,void 0,(function*(){m.j7.loading();try{yield l.removeCheckpoint(e.assignment_id,e.id)}catch(a){m.j7.axiosError(a,"No se pudo eliminar")}m.j7.loading(!1)})),title:"Eliminar Checkpoint"})}return(0,t.wF)((()=>{p.params&&p.params.id&&(v.value=Number(p.params.id))})),(e,a)=>{const l=(0,t.up)("q-btn"),i=(0,t.up)("q-chip"),u=(0,t.up)("q-card-section"),r=(0,t.up)("q-icon"),m=(0,t.up)("q-item-section"),d=(0,t.up)("q-item"),p=(0,t.up)("q-item-label"),v=(0,t.up)("q-avatar"),U=(0,t.up)("q-list"),C=(0,t.up)("q-card"),q=(0,t.up)("q-dialog"),S=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(S,{padding:""},{default:(0,t.w5)((()=>[(0,n.SU)(k)?((0,t.wg)(),(0,t.j4)(C,{key:0,class:"no-box-shadow"},{default:(0,t.w5)((()=>[(0,t._)("div",j,[(0,t._)("div",x,[(0,t.Wm)(u,{class:"q-gutter-y-sm"},{default:(0,t.w5)((()=>[(0,t._)("div",Q,(0,o.zw)((0,n.SU)(k).name),1),(0,n.SU)(W)?((0,t.wg)(),(0,t.iD)("div",V,[(0,t.Wm)(l,{color:"primary",icon:"mdi-pencil",label:"Administrar",class:"full-width",onClick:a[0]||(a[0]=e=>_.value=!0)})])):(0,t.kq)("",!0),(0,t._)("div",E,[(0,t.Wm)(i,{class:"glossy",icon:0===(0,n.SU)(k).status?"mdi-clock":"mdi-check",label:0===(0,n.SU)(k).status?"En Progreso":"Completado",color:0===(0,n.SU)(k).status?"":"positive"},null,8,["icon","label","color"])])])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>{var e;return[(0,n.SU)(k).agent?((0,t.wg)(),(0,t.iD)("p",I,[(0,t.Wm)(r,{name:"mdi-account",class:"q-mr-sm"}),(0,t.Uk)(" "+(0,o.zw)(null===(e=(0,n.SU)(k).agent)||void 0===e?void 0:e.nick),1)])):(0,t.kq)("",!0),(0,t._)("p",H," Descripción: "+(0,o.zw)((0,n.SU)(k).description),1),(0,n.SU)(k).observations?((0,t.wg)(),(0,t.iD)("p",z," Observaciones: "+(0,o.zw)((0,n.SU)(k).observations),1)):(0,t.kq)("",!0)]})),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[D,(0,t.Wm)(U,{bordered:"",class:"q-mt-sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{clickable:"",onClick:a[1]||(a[1]=e=>g.value=void 0)},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{avatar:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"mdi-map-marker"})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[P])),_:1})])),_:1}),(0,n.SU)(W)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(d,{key:0,clickable:"",onClick:B},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{avatar:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"mdi-map-marker"})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[N])),_:1})])),_:1})),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,n.SU)(k).checkpoints,((e,a)=>((0,t.wg)(),(0,t.j4)(d,{key:`checkpoint-${e.id}-index-${a}`},{default:(0,t.w5)((()=>[(0,n.SU)(F)?((0,t.wg)(),(0,t.j4)(m,{key:0,class:"cursor-pointer",avatar:"",onClick:a=>L(e.id)},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"mdi-eye"})])),_:2},1032,["onClick"])):((0,t.wg)(),(0,t.j4)(m,{key:1,class:"cursor-pointer",avatar:"",onClick:a=>g.value=e},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"mdi-map-marker"})])),_:2},1032,["onClick"])),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.name),1)])),_:2},1024),(0,t.Wm)(p,{caption:"",lines:"2"},{default:(0,t.w5)((()=>[0===e.status?((0,t.wg)(),(0,t.j4)(i,{key:0,class:"glossy",size:"sm",icon:"mdi-clock",label:"Pendiente"})):((0,t.wg)(),(0,t.j4)(i,{key:1,class:"glossy",size:"sm",icon:"mdi-check",label:"Completado"}))])),_:2},1024)])),_:2},1024),(0,n.SU)(W)?((0,t.wg)(),(0,t.j4)(m,{key:2,avatar:"",class:"cursor-pointer",onClick:a=>O(e)},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"mdi-delete",color:"negative"})])),_:2},1032,["onClick"])):(0,t.kq)("",!0)])),_:2},1024)))),128)),(0,n.SU)(W)?((0,t.wg)(),(0,t.j4)(d,{key:1,clickable:"",onClick:a[2]||(a[2]=e=>y.value=!0)},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{top:"",avatar:""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{color:"positive","text-color":"white",icon:"mdi-plus",size:"sm"})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[A])),_:1})])),_:1})])),_:1})):(0,t.kq)("",!0)])),_:1})])),_:1})]),(0,n.SU)(F)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",T,[(0,t.Wm)(s.Z,{readonly:"",markers:(0,n.SU)(f),center:(0,n.SU)(f)[0],zoom:G.value,onUpdateZoom:a[3]||(a[3]=e=>G.value=e)},null,8,["markers","center","zoom"])]))])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(q,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=e=>_.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(c.Z,{style:{"min-width":"20rem"},assignment:(0,n.SU)(k),onCancel:M,onComplete:M},null,8,["assignment"])])),_:1},8,["modelValue"]),(0,t.Wm)(q,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>y.value=e)},{default:(0,t.w5)((()=>[(0,n.SU)(k)?((0,t.wg)(),(0,t.j4)(b,{key:0,style:{"min-width":"20rem"},assignment:(0,n.SU)(k),onCancel:M,onComplete:M},null,8,["assignment"])):(0,t.kq)("",!0)])),_:1},8,["modelValue"]),(0,n.SU)(w)?((0,t.wg)(),(0,t.j4)(q,{key:1,modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=e=>h.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{style:{"min-width":"20rem"}},{default:(0,t.w5)((()=>[(0,t.Wm)(s.Z,{markers:[(0,n.SU)(w)],readonly:""},null,8,["markers"])])),_:1})])),_:1},8,["modelValue"])):(0,t.kq)("",!0)])),_:1})}}});var G=l(9885),M=l(7691),L=l(2857),B=l(3246),O=l(490),$=l(1233),K=l(3115),Y=l(1357),J=l(2074);const R=F,X=R;_()(F,"components",{QPage:G.Z,QCard:v.Z,QCardSection:w.Z,QBtn:y.Z,QChip:M.Z,QIcon:L.Z,QList:B.Z,QItem:O.Z,QItemSection:$.Z,QItemLabel:K.Z,QAvatar:Y.Z,QDialog:J.Z})}}]);